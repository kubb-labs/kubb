openapi: 3.1.0
info:
  title: OpenAPI 3.1 Feature Test
  description: Test specification demonstrating OpenAPI 3.1 specific features
  version: 1.0.0

servers:
  - url: https://api.example.com

# OpenAPI 3.1 feature: webhooks
webhooks:
  newPet:
    post:
      summary: New pet notification
      description: Webhook triggered when a new pet is added
      operationId: onNewPet
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Pet'
      responses:
        '200':
          description: Webhook received successfully

paths:
  /pets:
    get:
      summary: List all pets
      operationId: listPets
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Pet'
              # OpenAPI 3.1 feature: multiple examples (instead of single example)
              examples:
                cats:
                  value:
                    - id: 1
                      name: Fluffy
                      type: cat
                dogs:
                  value:
                    - id: 2
                      name: Rex
                      type: dog
    post:
      summary: Create a pet
      operationId: createPet
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewPet'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Pet'
      # OpenAPI 3.0 feature: callbacks
      callbacks:
        petStatusChange:
          '{$request.body#/callbackUrl}':
            post:
              summary: Pet status changed
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      $ref: '#/components/schemas/PetStatusEvent'
              responses:
                '200':
                  description: Callback processed

  /pets/{petId}:
    get:
      summary: Get a pet by ID
      operationId: getPetById
      parameters:
        - name: petId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Pet'
          # OpenAPI 3.0 feature: links
          links:
            GetOwner:
              operationId: getOwnerById
              parameters:
                ownerId: '$response.body#/ownerId'

  /owners/{ownerId}:
    get:
      summary: Get an owner by ID
      operationId: getOwnerById
      parameters:
        - name: ownerId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Owner'

components:
  schemas:
    # OpenAPI 3.1 feature: const keyword
    PetType:
      type: object
      properties:
        catType:
          const: cat
        dogType:
          const: dog

    # OpenAPI 3.1 feature: type as array (replaces nullable)
    NullableString:
      type: [string, null]
      description: String that can be null

    # OpenAPI 3.1 feature: prefixItems for tuple validation
    Coordinate:
      type: array
      prefixItems:
        - type: number
          description: Latitude
        - type: number
          description: Longitude
      items: false
      minItems: 2
      maxItems: 2

    # JSON Schema 2020-12 feature: if/then/else
    ConditionalPet:
      type: object
      properties:
        type:
          type: string
          enum: [cat, dog]
        name:
          type: string
      if:
        properties:
          type:
            const: cat
      then:
        properties:
          meowSound:
            type: string
        required: [meowSound]
      else:
        properties:
          barkSound:
            type: string
        required: [barkSound]

    # JSON Schema 2020-12 feature: $defs (instead of components/schemas)
    PetWithDefs:
      type: object
      properties:
        name:
          type: string
        status:
          $ref: '#/$defs/Status'
      $defs:
        Status:
          type: string
          enum: [available, pending, sold]

    # JSON Schema 2020-12 feature: dependentSchemas
    BillingAddress:
      type: object
      properties:
        country:
          type: string
        state:
          type: string
        zipCode:
          type: string
      dependentSchemas:
        country:
          properties:
            countryCode:
              type: string
          required: [countryCode]

    # JSON Schema 2020-12 feature: dependentRequired
    CreditCard:
      type: object
      properties:
        cardNumber:
          type: string
        cvv:
          type: string
        expiryDate:
          type: string
      dependentRequired:
        cardNumber: [cvv, expiryDate]

    # JSON Schema 2020-12 feature: patternProperties
    DynamicConfig:
      type: object
      patternProperties:
        '^config_.*$':
          type: string
      additionalProperties: false

    # JSON Schema 2020-12 feature: unevaluatedProperties
    ExtendedPet:
      allOf:
        - $ref: '#/components/schemas/Pet'
        - type: object
          properties:
            color:
              type: string
      unevaluatedProperties: false

    # JSON Schema 2020-12 feature: propertyNames
    StrictObject:
      type: object
      propertyNames:
        pattern: '^[a-z]+$'
      additionalProperties:
        type: string

    # OpenAPI 3.1: exclusiveMinimum/Maximum as numbers (not booleans)
    Price:
      type: number
      exclusiveMinimum: 0
      exclusiveMaximum: 1000000

    # Standard schemas
    Pet:
      type: object
      required:
        - id
        - name
        - type
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        type:
          type: string
          enum: [cat, dog, bird]
        status:
          type: string
          enum: [available, pending, sold]
        ownerId:
          type: integer

    NewPet:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
        type:
          type: string
          enum: [cat, dog, bird]
        callbackUrl:
          type: string
          format: uri

    Owner:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
          format: email

    PetStatusEvent:
      type: object
      required:
        - petId
        - oldStatus
        - newStatus
        - timestamp
      properties:
        petId:
          type: integer
        oldStatus:
          type: string
        newStatus:
          type: string
        timestamp:
          type: string
          format: date-time

  securitySchemes:
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key

security:
  - apiKey: []
